import json
import requests
import time
from pathlib import Path

# ìºì‹œ ë°©ì§€ë¥¼ ìœ„í•´ íƒ€ì„ìŠ¤íƒ¬í”„ë¥¼ URLì— í¬í•¨
ALL_JSON_URL = f"https://smok95.github.io/lotto/results/all.json?t={int(time.time())}"
LOCAL_FILE = Path("2025lotto_numbers_1_to_1182_final.json")

def main():
    if not LOCAL_FILE.exists():
        print(f"âŒ íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŒ: {LOCAL_FILE}")
        return

    # ë¸Œë¼ìš°ì €ì¸ ê²ƒì²˜ëŸ¼ ì†ì—¬ ë³´ì•ˆ ì°¨ë‹¨ì„ í”¼í•¨ (ê°€ì¥ ì¤‘ìš”)
    headers = {
        'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36',
        'Accept': 'application/json'
    }

    try:
        print(f"ğŸŒ ë°ì´í„° í˜¸ì¶œ ì¤‘: {ALL_JSON_URL}")
        res = requests.get(ALL_JSON_URL, headers=headers, timeout=20)
        res.raise_for_status()
        all_data = res.json()
    except Exception as e:
        print(f"âŒ ë°ì´í„° ìˆ˜ì§‘ ì‹¤íŒ¨: {e}")
        return

    with open(LOCAL_FILE, "r", encoding="utf-8") as f:
        local_data = json.load(f)

    local_latest = local_data[0]["draw_no"]
    latest_item = all_data[-1] # ë¦¬ìŠ¤íŠ¸ì˜ ë§ˆì§€ë§‰ ìš”ì†Œê°€ ìµœì‹  1207íšŒ
    latest_draw = latest_item["draw_no"]

    print(f"ğŸ“Œ í˜„ì¬ ë¡œì»¬: {local_latest}íšŒ / ê°€ì ¸ì˜¨ ë°ì´í„°: {latest_draw}íšŒ")

    if latest_draw > local_latest:
        new_entry = {
            "draw_no": latest_draw,
            "numbers": latest_item["numbers"],
            "bonus": latest_item["bonus_no"]
        }
        local_data.insert(0, new_entry) # ë§¨ ì•ì— ì¶”ê°€
        
        with open(LOCAL_FILE, "w", encoding="utf-8") as f:
            json.dump(local_data, f, ensure_ascii=False, indent=2)
        print(f"ğŸ‰ {latest_draw}íšŒì°¨ ì—…ë°ì´íŠ¸ ì„±ê³µ!")
    else:
        print("âœ… ì´ë¯¸ ìµœì‹  ìƒíƒœì…ë‹ˆë‹¤.")

if __name__ == "__main__":
    main()
