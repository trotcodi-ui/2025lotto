import json
import requests
from pathlib import Path

# ë™í–‰ë³µê¶Œ ê³µì‹ API ì£¼ì†Œ
API_URL = "https://www.dhlottery.co.kr/common.do?method=getLottoNumber&drwNo="
LOCAL_FILE = Path("2025lotto_numbers_1_to_1182_final.json")

def get_lotto_data(draw_no):
    headers = {'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36'}
    try:
        res = requests.get(f"{API_URL}{draw_no}", headers=headers, timeout=15)
        res.raise_for_status()
        data = res.json()
        if data.get("returnValue") == "success":
            return {
                "draw_no": draw_no,
                "numbers": [data[f"drwtNo{i}"] for i in range(1, 7)],
                "bonus": data["bnusNo"]
            }
    except Exception as e:
        print(f"âŒ {draw_no}íšŒì°¨ í˜¸ì¶œ ì‹¤íŒ¨: {e}")
    return None

def main():
    if not LOCAL_FILE.exists():
        print("âŒ ë¡œì»¬ JSON íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.")
        return

    with open(LOCAL_FILE, "r", encoding="utf-8") as f:
        local_data = json.load(f)

    # ë‚´ íŒŒì¼ì˜ ê°€ì¥ ìµœì‹  íšŒì°¨ í™•ì¸ í›„ ë‹¤ìŒ íšŒì°¨ ê²°ì •
    last_draw = local_data[0]["draw_no"]
    target_draw = last_draw + 1
    
    print(f"ğŸ“Œ í˜„ì¬ ë‚´ íŒŒì¼ ìµœì‹ : {last_draw}íšŒ / ìƒˆë¡œ ê°€ì ¸ì˜¬ íšŒì°¨: {target_draw}íšŒ")

    new_entry = get_lotto_data(target_draw)

    if new_entry:
        local_data.insert(0, new_entry) # ë§¨ ì•ì— ìƒˆ ë°ì´í„° ì‚½ì…
        with open(LOCAL_FILE, "w", encoding="utf-8") as f:
            json.dump(local_data, f, ensure_ascii=False, indent=2)
        print(f"ğŸ‰ {target_draw}íšŒì°¨(1207íšŒ ë“±) ì—…ë°ì´íŠ¸ ì„±ê³µ!")
    else:
        print(f"â„¹ï¸ {target_draw}íšŒì°¨ ë°ì´í„°ê°€ ì•„ì§ ê³µì‹ ì‚¬ì´íŠ¸ì— ì—…ë°ì´íŠ¸ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.")

if __name__ == "__main__":
    main()
