import json
import requests
from pathlib import Path

# ğŸ”’ ë™í–‰ API ì™„ì „ ë¯¸ì‚¬ìš©
MIRROR_URL = "https://raw.githubusercontent.com/zeeyang/lotto-history/master/lotto.json"
OUTPUT_FILE = Path("2025lotto_numbers_1_to_1182_final.json")

print("ğŸ“¥ GitHub ë¯¸ëŸ¬ JSON ë¡œë”© ì¤‘...")

res = requests.get(MIRROR_URL, timeout=15)
res.raise_for_status()
mirror = res.json()

print(f"ğŸ“¦ ë¯¸ëŸ¬ ì´ íšŒì°¨ ìˆ˜: {len(mirror)}")

# ê¸°ì¡´ íŒŒì¼ ë¡œë“œ
existing = []
if OUTPUT_FILE.exists():
    with open(OUTPUT_FILE, "r", encoding="utf-8") as f:
        existing = json.load(f)

existing_draws = {d["draw_no"] for d in existing}

new_items = []

for item in mirror:
    draw_no = item.get("drwNo")
    if draw_no is None or draw_no in existing_draws:
        continue

    new_items.append({
        "draw_no": draw_no,
        "numbers": [
            item["drwtNo1"],
            item["drwtNo2"],
            item["drwtNo3"],
            item["drwtNo4"],
            item["drwtNo5"],
            item["drwtNo6"],
        ],
        "bonus": item["bnusNo"]
    })

if not new_items:
    print("âœ… ì¶”ê°€í•  ìƒˆ íšŒì°¨ ì—†ìŒ")
else:
    print(f"ğŸ†• ìƒˆ íšŒì°¨ {len(new_items)}ê°œ ì¶”ê°€")

    existing.extend(sorted(new_items, key=lambda x: x["draw_no"]))

    with open(OUTPUT_FILE, "w", encoding="utf-8") as f:
        json.dump(existing, f, ensure_ascii=False, indent=2)

    print("ğŸ’¾ JSON ì—…ë°ì´íŠ¸ ì™„ë£Œ")
