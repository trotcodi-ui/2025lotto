import json
import requests
from pathlib import Path

FILE_PATH = "2025lotto_numbers_1_to_1182_final.json"
MIRROR_URL = "https://raw.githubusercontent.com/zeeyang/lotto-history/master/lotto.json"

def main():
    if not Path(FILE_PATH).exists():
        print("âŒ ë¡œì»¬ JSON íŒŒì¼ ì—†ìŒ")
        return

    # ë¡œì»¬ ë°ì´í„° ë¡œë“œ
    with open(FILE_PATH, "r", encoding="utf-8") as f:
        local_data = json.load(f)

    latest_local_draw = max(item["draw_no"] for item in local_data)
    print(f"ğŸ“Œ ë¡œì»¬ ìµœì‹  íšŒì°¨: {latest_local_draw}")

    # ë¯¸ëŸ¬ JSON ë¡œë“œ
    try:
        res = requests.get(MIRROR_URL, timeout=15)
        res.raise_for_status()
        mirror_data = res.json()
    except Exception as e:
        print("âŒ ë¯¸ëŸ¬ JSON ë¡œë“œ ì‹¤íŒ¨:", e)
        return

    # ë¯¸ëŸ¬ ìµœì‹  íšŒì°¨
    latest_mirror = max(mirror_data, key=lambda x: x["drwNo"])
    mirror_draw_no = latest_mirror["drwNo"]

    print(f"ğŸŒ ë¯¸ëŸ¬ ìµœì‹  íšŒì°¨: {mirror_draw_no}")

    if mirror_draw_no <= latest_local_draw:
        print("âœ… ì´ë¯¸ ìµœì‹  ìƒíƒœ")
        return

    # ìƒˆ íšŒì°¨ ë³€í™˜
    new_entry = {
        "draw_no": mirror_draw_no,
        "numbers": [
            latest_mirror["drwtNo1"],
            latest_mirror["drwtNo2"],
            latest_mirror["drwtNo3"],
            latest_mirror["drwtNo4"],
            latest_mirror["drwtNo5"],
            latest_mirror["drwtNo6"],
        ],
        "bonus": latest_mirror["bnusNo"]
    }

    # ë§¨ ì•ì— ì¶”ê°€
    local_data.insert(0, new_entry)

    with open(FILE_PATH, "w", encoding="utf-8") as f:
        json.dump(local_data, f, ensure_ascii=False, indent=2)

    print(f"ğŸ‰ {mirror_draw_no}íšŒì°¨ ì—…ë°ì´íŠ¸ ì™„ë£Œ")

if __name__ == "__main__":
    main()
