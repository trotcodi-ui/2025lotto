import json
import requests
from pathlib import Path

ALL_JSON_URL = "https://smok95.github.io/lotto/results/all.json"
LOCAL_FILE = Path("2025lotto_numbers_1_to_1182_final.json")

def main():
    # 1ï¸âƒ£ ë¡œì»¬ JSON ë¡œë“œ
    if not LOCAL_FILE.exists():
        print("âŒ ë¡œì»¬ JSON íŒŒì¼ ì—†ìŒ")
        return

    with open(LOCAL_FILE, "r", encoding="utf-8") as f:
        local_data = json.load(f)

    # âœ… ë¡œì»¬ ìµœì‹  íšŒì°¨ = ì²« ë²ˆì§¸ ìš”ì†Œ
    local_latest = local_data[0]["draw_no"]
    print(f"ğŸ“Œ ë¡œì»¬ ìµœì‹  íšŒì°¨: {local_latest}")

    # 2ï¸âƒ£ GitHub ì „ì²´ JSON ë¡œë“œ
    res = requests.get(ALL_JSON_URL, timeout=20)
    res.raise_for_status()
    all_data = res.json()

    if not all_data:
        print("âŒ all.json ë¹„ì–´ ìˆìŒ")
        return

    # âœ… GitHub ìµœì‹  íšŒì°¨ = ë§ˆì§€ë§‰ ìš”ì†Œ
    latest = all_data[-1]
    latest_draw = latest["draw_no"]
    print(f"ğŸŒ GitHub ìµœì‹  íšŒì°¨: {latest_draw}")

    # 3ï¸âƒ£ ìµœì‹  íšŒì°¨ê°€ ê°™ê±°ë‚˜ ì‘ìœ¼ë©´ ì¢…ë£Œ
    if latest_draw == local_latest:
        print("âœ… ì´ë¯¸ ìµœì‹  ìƒíƒœ")
        return

    if latest_draw < local_latest:
        print("âš ï¸ ë¡œì»¬ ë°ì´í„°ê°€ ë” ìµœì‹ ì„ (ë¹„ì •ìƒ)")
        return

    # 4ï¸âƒ£ ìµœì‹  íšŒì°¨ 1ê°œë§Œ ì¶”ê°€
    new_entry = {
        "draw_no": latest_draw,
        "numbers": latest["numbers"],
        "bonus": latest["bonus_no"]
    }

    local_data.insert(0, new_entry)

    # 5ï¸âƒ£ ì €ì¥
    with open(LOCAL_FILE, "w", encoding="utf-8") as f:
        json.dump(local_data, f, ensure_ascii=False, indent=2)

    print(f"ğŸ‰ {latest_draw}íšŒì°¨ ì—…ë°ì´íŠ¸ ì™„ë£Œ")

if __name__ == "__main__":
    main()
